---
layout: post
title:  "Setting up IBM Microgateway for standalone use"
category:
- microgateway
comments: true
---

Recently IBM announced to open source their micro-gateway application that was earlier bundled for
exclusive use with API Connect. For detailed information read this [blog](https://strongloop.com/strongblog/introducing-api-microgateway-programmable-open-source-gateway-apis/)

This article can be considered as an addendum to above blog as I explain how to configure micro-gateway as a
standalone software after forking from github. This article has been tested on micro-gateway version 1.6.1.

First you should install loopback and apiconnect using following 2 commands
```
npm install -g loopback
npm install -g apiconnect
```

API Connect CLI does provide a quick and easy way to generate required artifacts from a loopback project.

* First create a loopback API using `lb app` command. You can look more information in [loopback docs](http://loopback.io/doc/).
* Second run command `apic loopback:refresh` in the main folder of loopback app. This command creates the
  definitions folder in your loopback project. Inside it there are 2 files, one describing all the APIs
  with their definitions and schema based on the model. Second is the metadata description of the API.
* In third step, copy the files from <loopback app>/definitions folder to <micro-gateway>/definitions
  folder.
* In fourth step, edit the definitions folder and remove the `catalogs` tag from under `x-ibm-configuration`
  tag. Catalogs are used with API Connect product and are not needed on standalone gateway.
* In fifth step, add following tag with the endpoint of your loopback application server. As you can see
  we have defined a property named `runtime-url` that is referenced in the *invoke* policy of *assembly*.
  ```
  x-ibm-configuration:
    testable: true
    enforced: true
    cors:
      enabled: true
    properties:
      runtime-url:
        value: 'http://localhost:3000'
    assembly:
      execute:
        invoke:
          target-url: $(runtime-url)$(request.path)$(request.search)
  ```
* In sixth step, review the security definitions as generated by `apic`. You might want to remove the
  `security` tag as it would in most cases be composed of empty array for client id and client secret.
* In sevent step, you need to create an `env.yaml` file inside the micro-gateway app directory defining
  gateway environment properties. All the available gateway properties can be found [here](https://www.ibm.com/support/knowledgecenter/en/SSMNED_5.0.0/com.ibm.apic.install.doc/rapic_environment_vars_mg.html). A sample `env.yaml` file is as below
  ```
  swagger: '2.0'

  CONFIG_DIR: './definitions'
  CATALOG_HOST: 'localhost:4000'
  PORT: '4000'
  APIC_LOG_CONSOLE_LEVEL: 'DEBUG'
  ```

Next you are good to start both the loopback and micro-gateway servers to test your APIs through gateway.
To start the servers use command `node .`

If the `schemes` (in API definition) has been set to http use http else https as protocol
to invoke gateway.

**P.S. If you have already created your API specs using swagger then just adding the x-ibm-configuration tag to the API specification should do the trick.**